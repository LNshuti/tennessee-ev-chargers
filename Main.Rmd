---
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)

repo_path <- "tennessee-ev-chargers"

suppressWarnings(suppressMessages(source(paste0(repo_path, "/manifest.R"))))
# census_api_key(key = "172fe4d0406dc33d213ab43cf13a042c180c421f", 
#                overwrite = TRUE)
```


```{r}
# tn_wide <- get_acs(
#   geography = "county",
#   state = "Tennessee",
#   variables = c(medinc = "B19013_001"),
#   output = "wide",
#   year = 2019
# )

#readr::write_csv(tn_wide, paste0(repo_path, "/data/tn_medianincome_2019.csv"))
```


```{r}
tn_wide <- 
  read_csv(paste0(repo_path, "/data/tn_medianincome_2019.csv")) %>% 
  janitor::clean_names() %>% 
  mutate(geoid = paste0(geoid))


sf_county <-
  read_sf(paste0(repo_path,
                 "/data/county/01_county-shape-file.shp")) %>% 
  st_transform(crs = 4326) %>% 
  filter(statefp == "47") %>% 
  left_join(tn_wide, by = "geoid")


tn_income_plt <-
  sf_county %>%
  ggplot() + 
  geom_sf(aes(fill = medinc_e)) +
  scale_fill_gradient2(low = scales::muted("blue"),
                       mid = "white",high = scales::muted("red"),
                       midpoint = 44122,limits = c(0,150000)) + 
  coord_sf(datum=NA) + 
  labs(fill="Median Income") + 
  ggtitle("Tennessee Median Income by county, 2019") + 
  ggthemes::theme_tufte(base_family = "Gill Sans")

ggsave(tn_income_plt,
       filename = paste0(repo_path, "/output/tn_income_2019.png"), 
       width = 8, height = 4)
```
